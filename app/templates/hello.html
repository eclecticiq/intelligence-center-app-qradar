{% extends "base.html" %}
{% block body %}
     {% if context.status in [None, ''] %}
     <div class="row" style="text-align: -webkit-center;">

     </div>
     {% elif context.status=="Test Connection Successful."%}
     <div class="row" style="text-align: -webkit-center;">
            <h3 class="success-msg" >{{context.status}}</h3>
     </div>
     {% elif context.status=="Configuration saved Successfully ."%}
     <div class="row" style="text-align: -webkit-center;">
            <h3 class="success-msg" >{{context.status}}</h3>
     </div>
     {% elif context.status=="Configuration saved successfully."%}
     <div class="row" style="text-align: -webkit-center;">
            <h3 class="success-msg" >{{context.status}}</h3>
     </div>
     {% else %}
          <div class="row" style="text-align: -webkit-center;">
            <h3 class="error-msg" >{{context.status}}</h3>
     </div>
     {% endif %}
 <form action="./save" method="POST" class="config" id="configure-form" enctype="multipart/form-data">
     <div class="logoContainer">
    <img class="logo" src="static/images/EiqLogo.png" alt="EclecticIQ logo" width="200" height="50">
    </div>
    <hr class="formSeperator">

    <dl class="formContainer" style="color: white;padding: 20px;">
        {% if context.status=="Test Connection Successful."%}
            <input type="hidden" id="csrf_token" name="csrf_token" value="{{ csrf_token() }}"/>
            <dt>Name <span>* </span></dt>
            <dd><input class="textinput" value="{{context.auth_user}}" type="text" size="50" id="name" placeholder="Name " name="name" form="configure-form" autocomplete="off" required readonly></dd>
            <br />
            <dt>Host *</dt>
            <dd><input class="textinput"  value="{{context.host}}" type="text" size="50" id="host" placeholder="Host"  name="host" form="configure-form" autocomplete="off" required readonly></dd>
            <br />
            <dt>API Key *</dt>
            <dd><input  value="{{context.api_key}}" class="textinput" type="password" size="50"  id="api_key" placeholder="API Key" name="api_key" form="configure-form" autocomplete="off" required readonly></dd>
            <br />
    		<dt>Qradar Security Token *</dt>
            <dd><input  value="{{context.qradar_security_token}}" class="textinput" type="password" size="50"  id="security_token" placeholder="Qradar Security token" name="security_token" form="configure-form" autocomplete="off" required readonly></dd>
            <br />
            <dd><input type="checkbox" id="is_self_signed_cert" class="hellocheckbox" name="is_self_signed_cert" form="configure-form" onclick="return false;"> Use self signed certificate</dd>
            <br />
            <div id="test_connection" class="lds-dual-ring hidden overlay"></div>
            <div id="connection_message"></div>
            <br />
            <dd class="sumbitButton"  >
                <input  formaction="./test_connection" formmethod="POST" id="test_connection_button" class="tc_dialog_button tc_save" type="submit"
                       value="Test Connection" form="configure-form" disabled/>
            </dd>
            <dd class="sumbitButton">
                <input formmethod="POST" id="save_indicator_button" class="tc_dialog_button tc_save" type="submit"
                       value="Save" form="configure-form"/>
            </dd>
            <br/>
            <p id="loading" hidden style="text-align:center">Loading...</p>
        {% else %}
            <input type="hidden" id="csrf_token" name="csrf_token" value="{{ csrf_token() }}"/>
            <dt>Name <span>* </span></dt>
            <dd><input class="textinput" value="{{context.auth_user}}" type="text" size="50" id="name" placeholder="Name " name="name" form="configure-form" autocomplete="off" required ></dd>
            <br />
            <dt>Host *</dt>
            <dd><input class="textinput"  value="{{context.host}}" type="text" size="50" id="host" placeholder="Host"  name="host" form="configure-form" autocomplete="off" required></dd>
            <br />
            <dt>API Key *</dt>
            <dd><input  value="{{context.api_key}}" class="textinput" type="password" size="50"  id="api_key" placeholder="API Key" name="api_key" form="configure-form" autocomplete="off" required></dd>
            <br />
    		<dt>Qradar Security Token *</dt>
            <dd><input  value="{{context.qradar_security_token}}" class="textinput" type="password" size="50"  id="security_token" placeholder="Qradar Security token" name="security_token" form="configure-form" autocomplete="off" required></dd>
            <br />
            <dd><input type="checkbox" id="is_self_signed_cert" class="hellocheckbox" name="is_self_signed_cert" form="configure-form" > Use self signed certificate</dd>
            <br/>
            <dd><input value="{{context.certificate_file}}" type="file" id="certificate_file" name="certificate_file" form="configure-form" hidden disabled></dd>
            <br />
             <div id="test_connection" class="lds-dual-ring hidden overlay"></div>
            <div id="connection_message"></div>
            <br />
            <dd class="sumbitButton"  >
                <input  formaction="./test_connection" formmethod="POST" id="test_connection_button" class="tc_dialog_button tc_save" type="submit"
                       value="Test Connection" form="configure-form"/>
            </dd>
            <dd class="sumbitButton">
                <input formmethod="POST" id="save_indicator_button" class="tc_dialog_button tc_save" type="submit"
                       value="Save" form="configure-form" disabled/>
            </dd>
            <br/>
            <p id="loading" hidden style="text-align:center">Loading...</p>
       {% endif %}
    </dl>
</form>
{% endblock %}

    {% block script %}

     <script src="./static/js/lib/jquery-3.5.1.min.js" type="text/javascript" ></script>
             <script src="./static/js/lib/jquery.dataTables.min.js"></script>
             <script src="./static/js/lib/jquery.slimscroll.js"></script>
       <script>

        $(document).ready(function() {
            console.log("Inside ready function");
            $('#is_self_signed_cert').change(function() {
                if(this.checked) {
                    console.log("if block is called");
                    $('#certificate_file').prop('disabled', false);
                    $('#certificate_file').prop('hidden', false);
                } else {
                    console.log("else block is called");
                    $('#certificate_file').prop('disabled', true);
                    $('#certificate_file').prop('hidden', true);
                    $('#certificate_file').val('');
                }
            });


        });
        $("#configure-form").submit(function (){
                    $("#loading").show();
                })
            {% if context.status!="Test Connection Successful."%}
            $(document).ready(function()
            {
                $(function(){
                    $.getJSON('./get', function(data) {
                        console.log('Hello', JSON.stringify(data))
                        var outgoingFeedData=data;
                        if (outgoingFeedData.auth_user != undefined && outgoingFeedData.auth_user != '')
                        {
                        $('#name').val(outgoingFeedData.auth_user)
                        }
                        if (outgoingFeedData.host != undefined && outgoingFeedData.host != '')
                        {
                         $('#host').val(outgoingFeedData.host+'/'+outgoingFeedData.version)
                        }
                    });
                    });
            });
            {% endif %}
            {% if context.is_self_signed_cert == True %}
            $('#is_self_signed_cert').prop('checked', true);
            {% endif %}

        </script>
    {% endblock %}